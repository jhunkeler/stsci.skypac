
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Sky matching for image mosaic. &#8212; SkyPac 0.9.10 (20-April-2018) documentation</title>
    <link rel="stylesheet" href="_static/stsci_sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SkyLine (chip outline on the sky) management for image mosaic." href="skyline.html" />
    <link rel="prev" title="Welcome to skypac’s documentation!" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="skyline.html" title="SkyLine (chip outline on the sky) management for image mosaic."
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to skypac’s documentation!"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SkyPac 0.9.10 (20-April-2018) documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/stsci_logo.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to skypac’s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="skyline.html"
                        title="next chapter">SkyLine (chip outline on the sky) management for image mosaic.</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/skymatch.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-stsci.skypac.skymatch">
<span id="sky-matching-for-image-mosaic"></span><h1>Sky matching for image mosaic.<a class="headerlink" href="#module-stsci.skypac.skymatch" title="Permalink to this headline">¶</a></h1>
<p>A module that provides functions for matching sky in overlapping images.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Authors:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">Mihai Cara, Warren Hack, Pey-Lian Lim (contact: <a class="reference external" href="mailto:help&#37;&#52;&#48;stsci&#46;edu">help<span>&#64;</span>stsci<span>&#46;</span>edu</a>)</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">License:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><a class="reference internal" href="LICENSE.html"><span class="doc">LICENSE</span></a></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="stsci.skypac.skymatch.TEAL_SkyMatch">
<code class="descclassname">stsci.skypac.skymatch.</code><code class="descname">TEAL_SkyMatch</code><span class="sig-paren">(</span><em>input</em>, <em>skymethod='globalmin+match'</em>, <em>match_down=True</em>, <em>skystat='mode'</em>, <em>lower=None</em>, <em>upper=None</em>, <em>nclip=5</em>, <em>lsigma=4.0</em>, <em>usigma=4.0</em>, <em>binwidth=0.1</em>, <em>skyuser_kwd='SKYUSER'</em>, <em>units_kwd='BUNIT'</em>, <em>invsens_kwd=None</em>, <em>readonly=True</em>, <em>subtractsky=False</em>, <em>dq_bits=None</em>, <em>optimize='balanced'</em>, <em>clobber=False</em>, <em>clean=True</em>, <em>verbose=True</em>, <em>logfile='skymatch.log'</em><span class="sig-paren">)</span><a class="headerlink" href="#stsci.skypac.skymatch.TEAL_SkyMatch" title="Permalink to this definition">¶</a></dt>
<dd><p>TEAL interface for <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a>. Most parameters are identical
to those of the <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a>. Here we mention only the differences:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Parameters:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><dl class="first last docutils">
<dt><strong>logfile</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str (Default = ‘skymatch_log.txt’)</span></dt>
<dd><p class="first last">Store execution log in this file. Always openned in append mode.
If not given (<code class="xref py py-obj docutils literal notranslate"><span class="pre">logfile</span></code>=<a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>), print to screen instead.
NOTE: Unlike <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">logfile</span></code> can <em>only</em> be either
a string file name or <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="stsci.skypac.skymatch.skymatch">
<code class="descclassname">stsci.skypac.skymatch.</code><code class="descname">skymatch</code><span class="sig-paren">(</span><em>input</em>, <em>skymethod='globalmin+match'</em>, <em>skystat='mode'</em>, <em>lower=None</em>, <em>upper=None</em>, <em>nclip=5</em>, <em>lsigma=4.0</em>, <em>usigma=4.0</em>, <em>binwidth=0.1</em>, <em>skyuser_kwd='SKYUSER'</em>, <em>units_kwd='BUNIT'</em>, <em>readonly=True</em>, <em>subtractsky=False</em>, <em>dq_bits=None</em>, <em>optimize='balanced'</em>, <em>clobber=False</em>, <em>clean=True</em>, <em>verbose=True</em>, <em>flog='skymatch_log.txt'</em><span class="sig-paren">)</span><a class="headerlink" href="#stsci.skypac.skymatch.skymatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Standalone task to compute and/or “equalize” sky in input images.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Sky matching (“equalization”) is possible only for <strong>overlapping</strong>
exposures.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When <code class="xref py py-obj docutils literal notranslate"><span class="pre">readonly</span></code> is <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>, image headers will be modified
and image data will be background-subtracted if <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> is
<a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>. Remember to back up original copies as desired.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Unlike previous sky subtraction algorithm used by
<a class="reference external" href="http://stsdas.stsci.edu/stsci_python_sphinxdocs_2.13/drizzlepac/astrodrizzle.html">astrodrizzle</a>, <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a> accounts for differences
in chip sensitivities by performing sky computations on data multiplied
by inverse sensitivity (e.g., value of <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code> in image headers
– see “Notes” section below).</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Parameters:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><dl class="first docutils">
<dt><strong>input</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str, list of FileExtMaskInfo</span></dt>
<dd><p class="first">A list of of <a class="reference internal" href="parseat.html#stsci.skypac.parseat.FileExtMaskInfo" title="stsci.skypac.parseat.FileExtMaskInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileExtMaskInfo</span></code></a> objects
or a string containing one of the following:</p>
<blockquote>
<div><ul class="simple">
<li>a comma-separated list of valid science image file names
(see note below) and (optionally) extension specifications,
e.g.: <code class="docutils literal notranslate"><span class="pre">'j1234567q_flt.fits[1],</span> <span class="pre">j1234568q_flt.fits[sci,2]'</span></code>;</li>
<li>an &#64;-file name, e.g., <code class="docutils literal notranslate"><span class="pre">'&#64;files_to_match.txt'</span></code>. See notes
section for details on the format of the &#64;-files.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Valid science image file names</strong> are:</p>
<ul class="last simple">
<li>file names of existing FITS, GEIS, or WAIVER FITS files;</li>
<li>partial file names containing wildcard characters, e.g.,
<code class="docutils literal notranslate"><span class="pre">'*_flt.fits'</span></code>;</li>
<li>Association (ASN) tables (must have <code class="docutils literal notranslate"><span class="pre">_asn</span></code>, or <code class="docutils literal notranslate"><span class="pre">_asc</span></code>
suffix), e.g., <code class="docutils literal notranslate"><span class="pre">'j12345670_asn.fits'</span></code>.</li>
</ul>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">&#64;-file names <strong>MAY NOT</strong> be followed by an extension
specification.</p>
</div>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If an association table or a partial file name with wildcard
characters is followed by an extension specification, it will be
considered that this extension specification applies to <strong>each</strong>
file name in the association table or <strong>each</strong> file name
obtained after wildcard expansion of the partial file name.</p>
</div>
</dd>
<dt><strong>skymethod</strong> <span class="classifier-delimiter">:</span> <span class="classifier">{‘localmin’, ‘globalmin+match’, ‘globalmin’, ‘match’} (Default = ‘globalmin+match’)</span></dt>
<dd><p class="first">Select the algorithm for sky computation:</p>
<ul class="last">
<li><p class="first"><strong>‘localmin’</strong>: compute a common sky for all members of
<em>an exposure</em> (see “Notes” section below). For a typical use, it
will compute sky values for each chip/image extension (marked for
sky subtraction in the <a class="reference external" href="https://docs.python.org/3/library/functions.html#input" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">input</span></code></a> parameter) in an input image,
and it will subtract the previously found minimum sky value
from all chips (marked for sky subtraction) in that image.
This process is repeated for each input image.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This setting is recommended when regions of overlap between images
are dominated by “pure” sky (as opposite to extended, diffuse
sources).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is similar to the “skysub” algorithm used in previous
versions of astrodrizzle.</p>
</div>
</li>
<li><p class="first"><strong>‘globalmin’</strong>: compute a common sky value for all members of
<em>all exposures</em> (see “Notes” section below). It will compute
sky values for each chip/image extension (marked for sky
subtraction in the <code class="xref py py-attr docutils literal notranslate"><span class="pre">input</span></code> parameter) in <strong>all</strong> input
images, find the minimum sky value, and then it will
subtract the <strong>same</strong> minimum sky value from <strong>all</strong> chips
(marked for sky subtraction) in <strong>all</strong> images. This method <em>may</em>
useful when input images already have matched background values.</p>
</li>
<li><p class="first"><strong>‘match’</strong>: compute differences in sky values between images
in common (pair-wise) sky regions. In this case computed sky values
will be relative (delta) to the sky computed in one of the
input images whose sky value will be set to (reported to be) 0.
This setting will “equalize” sky values between the images in
large mosaics. However, this method is not recommended when used
in conjunction with <a class="reference external" href="http://stsdas.stsci.edu/stsci_python_sphinxdocs_2.13/drizzlepac/astrodrizzle.html">astrodrizzle</a> because it
computes relative sky values while <code class="xref py py-obj docutils literal notranslate"><span class="pre">astrodrizzle</span></code> needs
“measured” sky values for median image generation and CR rejection.</p>
</li>
<li><p class="first"><strong>‘globalmin+match’</strong>: first find a minimum “global” sky value
in all input images and then use <strong>‘match’</strong> method to
equalize sky values between images.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is the <em>recommended</em> setting for images
containing diffuse sources (e.g., galaxies, nebulae)
covering significant parts of the image.</p>
</div>
</li>
</ul>
</dd>
<dt><strong>match_down</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = True)</span></dt>
<dd><p class="first">Specifies whether the sky <em>differences</em> should be subtracted from
images with higher sky values (<code class="xref py py-obj docutils literal notranslate"><span class="pre">match_down</span></code> = <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>) to match the
image with the lowest sky or sky differences should be added to the
images with lower sky values to match the sky of the image with the
highest sky value (<code class="xref py py-obj docutils literal notranslate"><span class="pre">match_down</span></code> = <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>).</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This setting applies <em>only</em> when <code class="xref py py-obj docutils literal notranslate"><span class="pre">skymethod</span></code> parameter is
either <code class="xref py py-obj docutils literal notranslate"><span class="pre">'match'</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">'globalmin+match'</span></code>.</p>
</div>
</dd>
<dt><strong>skystat</strong> <span class="classifier-delimiter">:</span> <span class="classifier">{‘mode’, ‘median’, ‘mode’, ‘midpt’} (Default = ‘mode’)</span></dt>
<dd><p class="first last">Statistical method for determining the sky value from the image
pixel values. See <code class="xref py py-obj docutils literal notranslate"><span class="pre">computeSky</span></code> for more detals.</p>
</dd>
<dt><strong>lower</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float, None (Default = None)</span></dt>
<dd><p class="first last">Lower limit of usable pixel values for computing the sky.
This value should be specified in the units of the input image(s).</p>
</dd>
<dt><strong>upper</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float, None (Default = None)</span></dt>
<dd><p class="first last">Upper limit of usable pixel values for computing the sky.
This value should be specified in the units of the input image(s).</p>
</dd>
<dt><strong>nclip</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int (Default = 5)</span></dt>
<dd><p class="first last">A non-negative number of clipping iterations to use when computing
the sky value.</p>
</dd>
<dt><strong>lsigma</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = 4.0)</span></dt>
<dd><p class="first last">Lower clipping limit, in sigma, used when computing the sky value.</p>
</dd>
<dt><strong>usigma</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = 4.0)</span></dt>
<dd><p class="first last">Upper clipping limit, in sigma, used when computing the sky value.</p>
</dd>
<dt><strong>binwidth</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float (Default = 0.1)</span></dt>
<dd><p class="first last">Bin width, in sigma, used to sample the distribution of pixel
brightness values in order to compute the sky background statistics.</p>
</dd>
<dt><strong>skyuser_kwd</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str (Default = ‘SKYUSER’)</span></dt>
<dd><p class="first">Name of header keyword which records the sky value previously
<em>subtracted</em> (if <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> is <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>) from the image data or
the <em>computed</em> (if <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> is <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>) sky value.
This keyword’s value will be updated by <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a>(if
<code class="xref py py-obj docutils literal notranslate"><span class="pre">readonly</span></code> is <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>).</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p>When <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> is <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a> then <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> is treated as a
<strong>cummulative</strong> value. That is, subtracted sky value will be
<strong>added</strong> to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> value and thus <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code>
represents <em>total</em> sky <em>subtracted</em> from the image by the user
over the entire “history” of the image.
If <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> is missing in the input image,
“previous” sky value will be considered to be 0.0.</p>
<p>When <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> is <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a> then <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> represents
<strong>computed</strong> sky value and it is <strong>not</strong> treated as a
<strong>cummulative</strong> value. Any previous value of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code>
header keyword will be <strong>overwritten</strong> with the newly computed
value.</p>
<p class="last">Because of different meanings of the value represented by the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> header keyword depending on the value of the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> parameter, it is important to be consistent
and not to mix the two modes when using <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a>
multiple times on the same images.</p>
</div>
</dd>
<dt><strong>units_kwd</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str (Default = ‘BUNIT’)</span></dt>
<dd><p class="first last">Name of header keyword which records the units of the data in the
image.</p>
</dd>
<dt><strong>invsens_kwd</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str, None (Default = ‘’)</span></dt>
<dd><p class="first">Name of header keyword which records the inverse sensitivity of the
detector used to acquire data. For <code class="xref py py-obj docutils literal notranslate"><span class="pre">HST</span></code> detectors, <code class="xref py py-obj docutils literal notranslate"><span class="pre">'PHOTFLAM</span></code> is
proportional to detector’s inverse sensitivity. It is used
to convert electron counts-like to photon counts by multiplying
count-like data (or count-rates) by the value indicated by this
keyword.</p>
<p class="last">By performing matching using photon counts (“flux units”), one can
match images from heterogeneous instruments. Default value <code class="xref py py-obj docutils literal notranslate"><span class="pre">''</span></code>
or <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> turns off use of inverse sensitivity.</p>
</dd>
<dt><strong>readonly</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = True)</span></dt>
<dd><p class="first last">Report the sky matching values but do not modify the input files.</p>
</dd>
<dt><strong>subtractsky</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = False)</span></dt>
<dd><p class="first">Subtract computed sky value from image data and add this value to the
existing value represented by <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> (<strong>subtracted sky</strong>)
or simply report the computed sky value in the header keyword
specified by <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> (<strong>computed sky</strong>).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Because <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> changes the <em>meaning</em> of the value of the
header keyword <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> it is important to be consistent
in using <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> parameter: inconsistent use may lead
to sky values reported in <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> header keyword that do not
reflect correct sky value <em>computed for</em> or <em>subtracted from</em>
flat-fielded images. A possible workaround is to use different
keywords for subtracted and computed sky, keeping in mind that the
order of operation will affect reported <em>computed</em> sky values.</p>
<p class="last">Also see warning for <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> parameter.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When <code class="xref py py-obj docutils literal notranslate"><span class="pre">readonly</span></code> is <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, reported sky values will be consistent
with the setting specified by <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> (as if <code class="xref py py-obj docutils literal notranslate"><span class="pre">readonly</span></code> is
<a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>), however sky values will <strong>NOT</strong> be subtracted from
the image data when <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code>=<a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.</p>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p><a class="reference external" href="http://stsdas.stsci.edu/stsci_python_sphinxdocs_2.13/drizzlepac/astrodrizzle.html">astrodrizzle</a>
does not subtract computed sky values from input
flat-fielded images. Therefore, when using <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a> on
images that subsequently will be processed by
<a class="reference external" href="http://stsdas.stsci.edu/stsci_python_sphinxdocs_2.13/drizzlepac/astrodrizzle.html">astrodrizzle</a>
it is <em>recommended</em> to use the following suggestions:</p>
<ul class="last simple">
<li>If one plans to turn on sky subtraction step in
<a class="reference external" href="http://stsdas.stsci.edu/stsci_python_sphinxdocs_2.13/drizzlepac/astrodrizzle.html">astrodrizzle</a> that will
involve additional sky computation (as opposite to using
<code class="xref py py-obj docutils literal notranslate"><span class="pre">astrodrizzle</span></code>’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyfile</span></code> parameters), then it is
recommended to set <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> to <a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a> and set
<code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> to the default value used by <code class="xref py py-obj docutils literal notranslate"><span class="pre">astrodrizzle</span></code>:
<code class="docutils literal notranslate"><span class="pre">MDRIZSKY</span></code>.</li>
<li>If one wants to effectively subtract the computed sky values
from the flat-fielded image data, then it is recommended to
set <code class="xref py py-obj docutils literal notranslate"><span class="pre">subtractsky</span></code> to <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> parameter to
something different from <code class="docutils literal notranslate"><span class="pre">MDRIZSKY</span></code>, (e.g., <code class="docutils literal notranslate"><span class="pre">SKYUSER</span></code>),
and set <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser</span></code> parameter in <a class="reference external" href="http://stsdas.stsci.edu/stsci_python_sphinxdocs_2.13/drizzlepac/astrodrizzle.html">astrodrizzle</a>
to the same value as the values of <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code> used
in the call to <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a>.</li>
</ul>
</div>
</dd>
<dt><strong>dq_bits</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int, str, None (Default = 0)</span></dt>
<dd><p class="first">Integer sum of all the DQ bit values from the input image’s
DQ array that should be considered “good” when building masks for
sky computations. For example, if pixels in the DQ array can be
combinations of 1, 2, 4, and 8 flags and one wants to consider DQ
“defects” having flags 2 and 4 as being acceptable for sky
computations, then <code class="xref py py-obj docutils literal notranslate"><span class="pre">dq_bits</span></code> should be set to 2+4=6. Then a DQ pixel
having values 2,4, or 6 will be considered a good pixel, while a
DQ pixel with a value, e.g., 1+2=3, 4+8=12, etc. will be flagged as
a “bad” pixel.</p>
<p>Alternatively, one can enter a comma- or ‘+’-separated list
of integer bit flags that should be added to obtain the
final “good” bits. For example, both <code class="docutils literal notranslate"><span class="pre">4,8</span></code> and <code class="docutils literal notranslate"><span class="pre">4+8</span></code>
are equivalent to setting <code class="xref py py-obj docutils literal notranslate"><span class="pre">dq_bits</span></code> to 12.</p>
<div class="line-block">
<div class="line">Default value (0) will make <em>all</em> non-zero
pixels in the DQ mask to be considered “bad” pixels, and the
corresponding image pixels will not be used for sky computations.</div>
</div>
<div class="line-block">
<div class="line">Set <code class="xref py py-obj docutils literal notranslate"><span class="pre">dq_bits</span></code> to <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a> to turn off the use of image’s DQ array
for sky computations.</div>
</div>
<div class="line-block">
<div class="line">In order to reverse the meaning of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">dq_bits</span></code>
parameter from indicating values of the “good” DQ flags
to indicating the “bad” DQ flags, prepend ‘~’ to the string
value. For example, in order not to use pixels with
DQ flags 4 and 8 for sky computations and to consider
as “good” all other pixels (regardless of their DQ flag),
set <code class="xref py py-obj docutils literal notranslate"><span class="pre">dq_bits</span></code> to <code class="docutils literal notranslate"><span class="pre">~4+8</span></code>, or <code class="docutils literal notranslate"><span class="pre">~4,8</span></code>. To obtain the
same effect with an <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a> input value (except for 0),
enter -(4+8+1)=-9. Following this convention,
a <code class="xref py py-obj docutils literal notranslate"><span class="pre">dq_bits</span></code> string value of <code class="docutils literal notranslate"><span class="pre">'~0'</span></code> would be equivalent to
setting <code class="docutils literal notranslate"><span class="pre">dq_bits=None</span></code>.</div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">DQ masks (if used), <em>will</em> <em>be</em> combined with user masks
specified in the input &#64;-file.</p>
</div>
</dd>
<dt><strong>optimize</strong> <span class="classifier-delimiter">:</span> <span class="classifier">{‘balanced’, ‘speed’, ‘inmemory’} (Default = ‘balanced’)</span></dt>
<dd><p class="first last">Specifies whether to optimize execution for speed (maximum memory
usage - loaded masks and images are not unloaded until the end
of the execution) or use a balanced approach in which a minimal
amount of image data is kept in memory and retrieved from
disk as needed. The ‘inmemory’ option is similar to the ‘speed’
setting except that masks are never saved to the files on a
physical disk but are created in memory. The default setting
is recommended for most systems.</p>
</dd>
<dt><strong>clobber</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = False)</span></dt>
<dd><p class="first last">When a input image file is in GEIS or WAIVER FITS format it must be
converted to simple/MEF FITS file format before it can be used by
<a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a>. This setting specifies whether any existing
simple/MEF files be overwritten during this conversion process. If
<code class="xref py py-obj docutils literal notranslate"><span class="pre">clobber</span></code>=<a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>, existing simple/MEF FITS files will be opened.
If <code class="xref py py-obj docutils literal notranslate"><span class="pre">clobber</span></code>=<a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, input GEIS or WAIVER FITS will be first
converted to simple FITS/MEF format overwritting (if necessary)
existing files and then these newly created simple FITS/MEF files
will be opened.</p>
</dd>
<dt><strong>clean</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = True)</span></dt>
<dd><p class="first last">Specifies whether to delete at the end of the execution any temporary
files created by <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a>.</p>
</dd>
<dt><strong>verbose</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool (Default = True)</span></dt>
<dd><p class="first last">Specifies whether to print warning messages.</p>
</dd>
<dt><strong>flog</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str, file object, MultiFileLog, None (Default = ‘skymatch_log.txt’)</span></dt>
<dd><p class="first last">Log file to which messages shoul be written. It can be a file name,
file object, or a MultiFileLog object. The later two allow the
log to be written to an existing open output stream passed
from the calling function such as
<a class="reference external" href="http://stsdas.stsci.edu/stsci_python_sphinxdocs_2.13/drizzlepac/astrodrizzle.html">astrodrizzle</a>.
Log file is always openned in append mode.
If not provided (None), print messages to screen only.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Raises:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><dl class="first last docutils">
<dt><strong>RuntimeError</strong></dt>
<dd><p class="first last">Could not add an image to mosaic. Possibly this SkyLine does
not intersect the mosaic.</p>
</dd>
<dt><strong>TypeError</strong></dt>
<dd><p class="first last">The <a class="reference external" href="https://docs.python.org/3/library/functions.html#input" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">input</span></code></a> argument must be either a Python list of
<a class="reference internal" href="parseat.html#stsci.skypac.parseat.FileExtMaskInfo" title="stsci.skypac.parseat.FileExtMaskInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileExtMaskInfo</span></code></a> objects, or a string
either containing either a comma-separated list file names,
or an &#64;-file name.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p><a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a> provides new algorithms for sky value computations
and enhances previously available algorithms used by, e.g.,
<a class="reference external" href="http://stsdas.stsci.edu/stsci_python_sphinxdocs_2.13/drizzlepac/astrodrizzle.html">astrodrizzle</a>.</p>
<p>First, the standard sky computation algorithm
(see <code class="xref py py-obj docutils literal notranslate"><span class="pre">skymethod</span></code> = <code class="docutils literal notranslate"><span class="pre">'localmin'</span></code>) was upgraded to be able to use
DQ flags and user supplied masks to remove “bad” pixels from being
used for sky statistics computations. Values different from zero in
user-supplied masks indicate “good” data pixels.</p>
<p>Second, two new methods have been introduced: <code class="docutils literal notranslate"><span class="pre">'globalmin'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'match'</span></code>, as well as a combination of the two – <code class="docutils literal notranslate"><span class="pre">'globalmin+match'</span></code>.</p>
<ul>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">'globalmin'</span></code> method computes the minimum sky value across <em>all</em>
chips in <em>all</em> input images. That sky value is then considered to be
the background in all input images.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">'match'</span></code> algorithm is somewhat
similar to the traditional sky subtraction method (<code class="xref py py-obj docutils literal notranslate"><span class="pre">skymethod</span></code>=      <code class="docutils literal notranslate"><span class="pre">'localmin'</span></code>) in the sense that it measures the sky indipendently
in input images (or detector chips). The major differences are that,
unlike the traditional method,</p>
<blockquote>
<div><ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">'match'</span></code> algorithm computes <em>relative</em> sky values with regard
to the sky in a reference image chosen from the input list
of images; <em>and</em></li>
<li>Sky statistics is computed only in the part of the image
that intersects other images.</li>
</ol>
</div></blockquote>
<p>This makes <code class="docutils literal notranslate"><span class="pre">'match'</span></code> sky computation algorithm particularly useful
for “equalizing” sky values in large mosaics in which one may have
only (at least) pair-wise intersection of images without having
a common intersection region (on the sky) in all images.</p>
<p>The <code class="xref py py-obj docutils literal notranslate"><span class="pre">'match'</span></code> method works in the following way: for each pair
of intersecting images, an equation is written that
requires that average surface brightness in the overlapping part of
the sky be equal in both images. The final system of equations is then
solved for unknown background levels.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Current algorithm is not capable of detecting cases when some groups of
intersecting images (from the input list of images) do not intersect
at all other groups of intersecting images (except for the simple
case when <em>single</em> images do not intersect any other images). In these
cases the algorithm will find equalizing sky values for each group.
However since these groups of images do not intersect each other,
sky will be matched only within each group and the “inter-group”
sky mismatch could be significant.</p>
<p class="last">Users are responsible for detecting such cases and adjusting processing
accordingly.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Because this method computes <em>relative sky values</em> compared to a
reference image (which will have its sky value set to 0), the sky
values computed with this method usually are smaller than the
“absolute” sky values computed, e.g., with the <code class="docutils literal notranslate"><span class="pre">'localmin'</span></code>
algorithm. Since <a class="reference external" href="http://stsdas.stsci.edu/stsci_python_sphinxdocs_2.13/drizzlepac/astrodrizzle.html">astrodrizzle</a> expects
“true” (as opposite to <em>relative</em>) sky values in order to
correctly compute the median image or to perform cosmic-ray
detection, this algorithm in not recommended to be used <em>alone</em>
for sky computations to be used with <code class="xref py py-obj docutils literal notranslate"><span class="pre">astrodrizzle</span></code>.</p>
<p class="last">For the same reason, IVM weighting in <code class="xref py py-obj docutils literal notranslate"><span class="pre">astrodrizzle</span></code> should <strong>not</strong>
be used with <code class="docutils literal notranslate"><span class="pre">'match'</span></code> method: sky values reported in <code class="docutils literal notranslate"><span class="pre">MDRIZSKY</span></code>
header keyword will be relative sky values (sky offsets) and derived
weights will be incorrect.</p>
</div>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">'globalmin+match'</span></code> algorithm combines <code class="docutils literal notranslate"><span class="pre">'match'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'globalmin'</span></code> methods in order to overcome the limitation of the
<code class="docutils literal notranslate"><span class="pre">'match'</span></code> method described in the note above: it uses <code class="docutils literal notranslate"><span class="pre">'globalmin'</span></code>
algorithm to find a baseline sky value common to all input images
and the <code class="docutils literal notranslate"><span class="pre">'match'</span></code> algorithm to “equalize” sky values in the mosaic.
Thus, the sky value of the “reference” image will be equal to the
baseline sky value (instead of 0 in <code class="docutils literal notranslate"><span class="pre">'match'</span></code> algorithm alone)
making this method acceptable for use in conjunction with
<code class="xref py py-obj docutils literal notranslate"><span class="pre">astrodrizzle</span></code>.</p>
</li>
</ul>
<dl class="docutils">
<dt><strong>“Surface Brightness”:</strong></dt>
<dd><p class="first"><a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a> converts “raw” sky values (in image data units)
obtained directly from image data to “surface brightness”-like units and
all computations are performed in these units. Computed sky surface
brightness values are converted back to image data units before being
subtracted from the image data and/or reported in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">skyuser_kwd</span></code>
in the image header.</p>
<p>This conversion from image data units to “surface brightness”-like units
is necessary in order to perform correct sky computations for data
from various intsruments/detectors. It accounts for differences in
exposure times (if image data are in “counts” units) in each input
image, differences in pixel scales of different detector chips
(instruments), and detector sensitivities.</p>
<p>For images with data in “counts”-like units, the conversion from data
units to surface brightness is given by:</p>
<div class="math">
<p><img src="_images/math/bed4c346ea121c9a6d25a5d8bb789ddd59464dae.png" alt="sky_{\mathrm{surface\: brightness}} = sky_{\mathrm{data\: units}}           \cdot \mathrm{PHOTFLAM} / (\mathrm{pixel\: Area}^2 \cdot           \mathrm{EXPTIME})"/></p>
</div><p>and for image data in “count-rate”-like units, this conversion is given
by:</p>
<div class="last math">
<p><img src="_images/math/eab7042a99f872756af959739b5db0b3bbb086fe.png" alt="sky_{\mathrm{surface\: brightness}} = sky_{\mathrm{data\: units}}           \cdot \mathrm{PHOTFLAM} / \mathrm{pixel\: Area}^2 ."/></p>
</div></dd>
<dt><strong>Important Header Keywords:</strong></dt>
<dd><p class="first">As discussed above, <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a> uses values of various keywords
in image headers to perform conversion of sky values to/from data units
from/to surface brightness units. The most important keywords are:</p>
<ul class="last">
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">BUNIT</span></code> describes the units of the image data. The units of data are
determined from the <code class="docutils literal notranslate"><span class="pre">BUNIT</span></code> header keyword by searching its value
for the division sign ‘/’. If the division sign is not found, then
the units are assumed to be “counts”. If the division sign is found
in the <code class="docutils literal notranslate"><span class="pre">BUNIT</span></code> value and if the numerator is one of the following:
<code class="docutils literal notranslate"><span class="pre">'ELECTRONS'</span></code>, <code class="docutils literal notranslate"><span class="pre">'COUNTS'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'DN'</span></code>, and denumerator is
either <code class="docutils literal notranslate"><span class="pre">'S'</span></code>, <code class="docutils literal notranslate"><span class="pre">'SEC'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'SECOND'</span></code>, then
the units are assumed to be count-rate.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">BUNIT</span></code> is missing then for non-<code class="docutils literal notranslate"><span class="pre">HST</span></code> images the units will
be assumed to be “count-rate”, while for <code class="docutils literal notranslate"><span class="pre">HST</span></code> images
(header keyword <code class="docutils literal notranslate"><span class="pre">TELESCOP</span></code>= <code class="docutils literal notranslate"><span class="pre">'HST'</span></code>) the <code class="docutils literal notranslate"><span class="pre">'INSTRUME'</span></code>
and <code class="docutils literal notranslate"><span class="pre">'DETECTOR'</span></code> keywords will be used to infer the units. For the
<code class="docutils literal notranslate"><span class="pre">NICMOS</span></code> instrument, <code class="docutils literal notranslate"><span class="pre">'UNITCORR'</span></code> will be used to infer the units.
If relevant keywords are missing, the units of image data will
be assumed to be “count-rate”. Check the log file for selected units.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">EXPTIME</span></code> – total exposure time, assumed to be in seconds. While
the units of <code class="docutils literal notranslate"><span class="pre">EXPTIME</span></code> are not important for sky computation, it is
important that all input images to <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a> use <em>the same</em>
units. This keyword is used only when inferred units for image
data are “count-rates”. If <code class="docutils literal notranslate"><span class="pre">EXPTIME</span></code> is missing when image data
units are counts, then variations in exposure time <strong>WILL NOT</strong> be
accounted for. First, the primary header of the image file is
searched for <code class="docutils literal notranslate"><span class="pre">EXPTIME</span></code> and if it is not found in the primary header,
then image extension is searched for the presense of <code class="docutils literal notranslate"><span class="pre">EXPTIME</span></code>
keyword.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code> – inverse sensitivity of the detector. At first
<a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a> will try to detect <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code> in the image
extension header and if not found, it will look for <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code>
in the primary header. If <code class="docutils literal notranslate"><span class="pre">PHOTFLAM</span></code> is not
present at all, the variations in detector sensitivity <strong>WILL NOT</strong>
be accounted for.</p>
</li>
</ul>
</dd>
<dt><strong>Glossary:</strong></dt>
<dd><p class="first"><strong>Exposure</strong> – a <em>subset</em> of FITS image extensions in an input image
that correspond to different chips in the detector used to acquire
the image. The subset of image extensions that form an exposure
is defined by specifying extensions to be used with input images
(see parameter <a class="reference external" href="https://docs.python.org/3/library/functions.html#input" title="(in Python v3.6)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">input</span></code></a>).</p>
<p>See help for <a class="reference internal" href="parseat.html#stsci.skypac.parseat.parse_at_line" title="stsci.skypac.parseat.parse_at_line"><code class="xref py py-func docutils literal notranslate"><span class="pre">stsci.skypac.parseat.parse_at_line()</span></code></a> for details
on how to specify image extensions.</p>
<p><strong>Footprint</strong> – the outline (edge) of the projection of a chip or
of an exposure on the celestial sphere.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Footprints are managed by the
<code class="xref py py-class docutils literal notranslate"><span class="pre">SphericalPolygon</span></code> class.</li>
<li>Both footprints <em>and</em> associated exposures (image data, WCS
information, and other header information) are managed by the
<a class="reference internal" href="skyline.html#stsci.skypac.skyline.SkyLine" title="stsci.skypac.skyline.SkyLine"><code class="xref py py-class docutils literal notranslate"><span class="pre">SkyLine</span></code></a> class.</li>
<li>Each <a class="reference internal" href="skyline.html#stsci.skypac.skyline.SkyLine" title="stsci.skypac.skyline.SkyLine"><code class="xref py py-class docutils literal notranslate"><span class="pre">SkyLine</span></code></a> object contains one
or more <a class="reference internal" href="skyline.html#stsci.skypac.skyline.SkyLineMember" title="stsci.skypac.skyline.SkyLineMember"><code class="xref py py-class docutils literal notranslate"><span class="pre">SkyLineMember</span></code></a> objects
that manage both footprints <em>and</em> associated <em>chip</em> data that
form an exposure.</li>
</ul>
</div>
</dd>
<dt><strong>Remarks:</strong></dt>
<dd><ul class="first last">
<li><p class="first"><a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a> works directly on <em>geometrically distorted</em>
flat-fielded images thus avoiding the need to perform an additional
drizzle step to perform distortion correction of input images.</p>
<p>Initially, the footprint of a chip in an image is aproximated by a
2D planar rectangle representing the borders of chip’s distorted
image. After applying distortion model to this rectangle and
progecting it onto the celestial sphere, it is approximated by
spherical polygons. Footprints of exposures and mosaics are
computed as unions of such spherical polygons while overlaps
of image pairs are found by intersecting these spherical polygons.</p>
</li>
</ul>
</dd>
<dt><strong>&#64;-File Format:</strong></dt>
<dd><p class="first">A catalog file containing a science image file
and extension specifications and optionally followed by a
comma-separated list of mask files and extension specifications
(or None).</p>
<p>File names will be stripped of leading and trailing white spaces. If it
is essential to keep these spaces, file names may be enclosed in single
or double quotation marks. Quotation marks may also be required when
file names contain special characters used to separate file names and
extension specifications: ,[]{}</p>
<p>Extension specifications must follow the file name and must be delimited
by either square or curly brackets. Curly brackets allow specifying
multiple comma-separated extensions: integer extension numbers and/or
tuples (‘ext name’, ext version).</p>
<dl class="docutils">
<dt>Some possible ways of specifying extensions:</dt>
<dd><p class="first">[1] – extension number</p>
<p>[‘sci’,2] – extension name and version</p>
<p>{1,4,(‘sci’,3)} – multiple extension specifications, including tuples</p>
<p>{(‘sci’,*)} – wildcard extension versions (i.e., all extensions with
extension name ‘sci’)</p>
<p>[‘sci’] – equivalent to [‘sci’,1]</p>
<p class="last">{‘sci’} – equivalent to {(‘sci’,*)}</p>
</dd>
</dl>
<p>For extensions in the science image for which no mask file is provided,
the corresponding mask file names may be omitted (but a comma must still
be used to show that no mask is provided in that position) or None can
be used in place of the file name. NOTE: ‘None’ (in quotation marks)
will be interpreted as a file named None.</p>
<dl class="docutils">
<dt>Some examples of possible user input:</dt>
<dd><p class="first">image1.fits{1,2,(‘sci’,3)},mask1.fits,,mask3.fits[0]</p>
<p>In this case:</p>
<p><code class="docutils literal notranslate"><span class="pre">image1.fits</span></code>[1] is associated with <code class="docutils literal notranslate"><span class="pre">mask1.fits</span></code>[0];</p>
<p><code class="docutils literal notranslate"><span class="pre">image1.fits</span></code>[2] does not have an associated mask;</p>
<p><code class="docutils literal notranslate"><span class="pre">image1.fits</span></code>[‘sci’,3] is associated with <code class="docutils literal notranslate"><span class="pre">mask3.fits</span></code>[0].</p>
<p>– Assume <code class="docutils literal notranslate"><span class="pre">image2.fits</span></code> has 4 ‘SCI’ extensions:</p>
<p>image2.fits{‘sci’},None,,mask3.fits</p>
<p>In this case:</p>
<p><code class="docutils literal notranslate"><span class="pre">image2.fits</span></code>[‘sci’,1] and <code class="docutils literal notranslate"><span class="pre">image2.fits</span></code>[‘sci’,2] <strong>and</strong>
<code class="docutils literal notranslate"><span class="pre">image2.fits</span></code>[‘sci’,4] do not have an associated mask;</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">image2.fits</span></code>[‘sci’,3] is associated with <code class="docutils literal notranslate"><span class="pre">mask3.fits</span></code>[0]</p>
</dd>
</dl>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">User mask data that indicate what pixels in the input <code class="xref py py-obj docutils literal notranslate"><span class="pre">image</span></code> should
be used for sky computations (<code class="docutils literal notranslate"><span class="pre">1</span></code>) and which pixels should <strong>not</strong>
be used for sky computations (<code class="docutils literal notranslate"><span class="pre">0</span></code>).</p>
</div>
</dd>
<dt><strong>Limitations and Discussions:</strong></dt>
<dd><p class="first">Primary reason for introducing “sky match” algorithm was to try to
equalize the sky in large mosaics in which computation of the
“absolute” sky is difficult due to the presence of large diffuse
sources in the image. As discussed above, <a class="reference internal" href="#stsci.skypac.skymatch.skymatch" title="stsci.skypac.skymatch.skymatch"><code class="xref py py-func docutils literal notranslate"><span class="pre">skymatch()</span></code></a>
accomplishes this by comparing “sky values” in a pair of images in the
overlap region (that is common to both images). Quite obviously the
quality of sky “matching” will depend on how well these “sky values”
can be estimated. We use quotation marks around <em>sky values</em> because
for some image “true” background may not be present at all and the
measured sky may be the surface brightness of large galaxy, nebula, etc.</p>
<p>Here is a brief list of possible limitations/factors that can affect
the outcome of the matching (sky subtraction in general) algorithm:</p>
<ul class="last simple">
<li>Since sky subtraction is performed on <em>flat-fielded</em> but
<em>not distortion corrected</em> images, it is important to keep in mind
that flat-fielding is performed to obtain uniform surface brightness
and not flux. This distinction is important for images that have
not been distortion corrected. As a consequence, it is advisable that
point-like sources be masked through the user-supplied mask files.
Values different from zero in user-supplied masks indicate “good” data
pixels. Alternatively, one can use <code class="xref py py-obj docutils literal notranslate"><span class="pre">upper</span></code> parameter to limit the use of
bright objects in sky computations.</li>
<li>Normally, distorted flat-fielded images contain cosmic rays. This
algorithm does not perform CR cleaning. A possible way of minimizing
the effect of the cosmic rays on sky computations is to use
clipping (<code class="xref py py-obj docutils literal notranslate"><span class="pre">nclip</span></code> &gt; 0) and/or set <code class="xref py py-obj docutils literal notranslate"><span class="pre">upper</span></code> parameter to a value
larger than most of the sky background (or extended source) but
lower than the values of most CR pixels.</li>
<li>In general, clipping is a good way of eliminating “bad” pixels:
pixels affected by CR, hot/dead pixels, etc. However, for
images with complicated backgrounds (extended galaxies, nebulae,
etc.), affected by CR and noise, clipping process may mask different
pixels in different images. If variations in the background are
too strong, clipping may converge to different sky values in
different images even when factoring in the “true” difference
in the sky background between the two images.</li>
<li>In general images can have different “true” background values
(we could measure it if images were not affected by large diffuse
sources). However, arguments such as <code class="xref py py-obj docutils literal notranslate"><span class="pre">lower</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">upper</span></code> will
apply to all images regardless of the intrinsic differences
in sky levels.</li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<ol class="arabic">
<li><p class="first">This task can be used to match skies of a set of ACS
images simply with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">stsci.skypac</span> <span class="k">import</span> <span class="n">skymatch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymatch</span><span class="p">(</span><span class="s1">&#39;j*q_flt.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">The TEAL GUI can be used to run this task using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">stsci.skypac</span> <span class="k">import</span> <span class="n">skymatch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">epar</span> <span class="n">skymatch</span>
</pre></div>
</div>
<p>or from a general Python command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">stsci.skypac</span> <span class="k">import</span> <span class="n">skymatch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">stsci.tools</span> <span class="k">import</span> <span class="n">teal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">teal</span><span class="o">.</span><span class="n">teal</span><span class="p">(</span><span class="s1">&#39;skymatch&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="skyline.html" title="SkyLine (chip outline on the sky) management for image mosaic."
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to skypac’s documentation!"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SkyPac 0.9.10 (20-April-2018) documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2013, Mihai Cara, Warren Hack, Pey Lian Lim.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.2.
    </div>
  </body>
</html>